<?php
// 1. تضمين ملف الاتصال بقاعدة البيانات
// تأكد أن مسار الملف صحيح
require 'db.php'; 

// 2. التحقق من وجود المعرف (ID) في الرابط
if (isset($_GET['id']) && is_numeric($_GET['id'])) {
    
    // 3. تخزين المعرف (ID) في متغير
    $user_id = $_GET['id'];

    // 4. إعداد استعلام الحذف الآمن باستخدام علامة الاستفهام (?) كبديل للقيمة
    $sql = "DELETE FROM users WHERE id = ?";
    
    // 5. تهيئة الاستعلام
    $stmt = $conn->prepare($sql);
    
    // 6. ربط قيمة المعرف (ID) بالاستعلام كعدد صحيح (i)
    $stmt->bind_param("i", $user_id);
    
    // 7. تنفيذ الاستعلام
    if ($stmt->execute()) {
        // إذا نجح الحذف، أرسل رسالة وقم بالتحويل
        // يمكنك تخزين رسالة نجاح في جلسة (Session) لعرضها على الصفحة الرئيسية
        echo "تم حذف المستخدم بنجاح!";
    } else {
        // إذا فشل التنفيذ، اعرض رسالة خطأ
        echo "حدث خطأ أثناء الحذف: " . $stmt->error;
    }
    
    // 8. إغلاق الاستعلام
    $stmt->close();

} else {
    // إذا لم يتم تمرير معرف (ID) صالح، اعرض رسالة خطأ
    echo "معرف المستخدم غير صالح أو مفقود.";
}

// 9. إغلاق الاتصال بعد الانتهاء
$conn->close();

// 10. التحويل إلى صفحة قائمة المستخدمين بعد الحذف
// هذا يمنع المستخدم من حذف نفس الصف إذا قام بتحديث الصفحة
header("Location: manager.php");
exit(); // يجب استخدامها بعد header() لمنع تنفيذ أي كود إضافي
?>